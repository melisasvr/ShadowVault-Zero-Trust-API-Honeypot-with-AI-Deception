<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShadowVault - Attack Monitoring Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #e0e0e0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #ff6b6b, #ee5a6f);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #888;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }

        .stat-card h3 {
            font-size: 0.9em;
            color: #888;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
        }

        .section {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 25px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.5em;
            color: #fff;
        }

        .refresh-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a6f);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s ease;
        }

        .refresh-btn:hover {
            transform: scale(1.05);
        }

        .attack-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .attack-table th {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            text-align: left;
            color: #4facfe;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85em;
        }

        .attack-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .attack-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-sql { background: #e74c3c; color: white; }
        .badge-xss { background: #e67e22; color: white; }
        .badge-path { background: #f39c12; color: white; }
        .badge-command { background: #9b59b6; color: white; }
        .badge-auth { background: #3498db; color: white; }
        .badge-recon { background: #95a5a6; color: white; }

        .ip-address {
            font-family: 'Courier New', monospace;
            color: #4facfe;
            font-weight: bold;
        }

        .timestamp {
            color: #888;
            font-size: 0.9em;
        }

        .ioc-list {
            display: grid;
            gap: 15px;
            margin-top: 15px;
        }

        .ioc-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ff6b6b;
        }

        .ioc-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .ioc-value {
            font-family: 'Courier New', monospace;
            color: #4facfe;
            font-weight: bold;
            word-break: break-all;
        }

        .confidence {
            background: linear-gradient(45deg, #11998e, #38ef7d);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .chart-box {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 10px;
        }

        .chart-title {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #4facfe;
        }

        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .bar-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bar-label {
            min-width: 120px;
            font-size: 0.9em;
        }

        .bar-fill {
            flex: 1;
            height: 25px;
            background: linear-gradient(90deg, #ff6b6b, #ee5a6f);
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }

        .bar-value {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
            color: white;
            font-size: 0.85em;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #38ef7d;
            animation: pulse 2s infinite;
            margin-right: 8px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #888;
            font-style: italic;
        }

        .export-btn {
            background: linear-gradient(45deg, #11998e, #38ef7d);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
            transition: transform 0.2s ease;
        }

        .export-btn:hover {
            transform: scale(1.05);
        }

        .top-attackers {
            margin-top: 15px;
        }

        .attacker-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            margin-bottom: 8px;
            border-radius: 8px;
        }

        .attacker-rank {
            background: #ff6b6b;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .attacker-info {
            flex: 1;
            margin-left: 15px;
        }

        .attacker-count {
            background: rgba(79, 172, 254, 0.2);
            color: #4facfe;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üïµÔ∏è ShadowVault</h1>
            <p class="subtitle">
                <span class="status-indicator"></span>
                Zero-Trust API Honeypot - Real-Time Attack Monitoring
            </p>
        </header>

        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <h3>Total Attacks</h3>
                <div class="stat-value" id="totalAttacks">0</div>
            </div>
            <div class="stat-card">
                <h3>Unique IPs</h3>
                <div class="stat-value" id="uniqueIPs">0</div>
            </div>
            <div class="stat-card">
                <h3>Generated IOCs</h3>
                <div class="stat-value" id="totalIOCs">0</div>
            </div>
            <div class="stat-card">
                <h3>Active Sessions</h3>
                <div class="stat-value" id="activeSessions">0</div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <h2 class="section-title">üìä Attack Analysis</h2>
                <div>
                    <button class="refresh-btn" onclick="loadData()">üîÑ Refresh</button>
                    <button class="export-btn" onclick="exportData()">üì• Export</button>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-box">
                    <div class="chart-title">Attacks by Type</div>
                    <div class="bar-chart" id="attackTypeChart"></div>
                </div>
                <div class="chart-box">
                    <div class="chart-title">üéØ Top Attackers</div>
                    <div class="top-attackers" id="topAttackers"></div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <h2 class="section-title">üö® Recent Attacks</h2>
            </div>
            <div id="recentAttacks">
                <div class="loading">Loading attack data...</div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <h2 class="section-title">üéØ Generated IOCs</h2>
            </div>
            <div class="ioc-list" id="iocList">
                <div class="loading">Loading IOCs...</div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';

        async function loadData() {
            try {
                await Promise.all([
                    loadStats(),
                    loadRecentAttacks(),
                    loadIOCs()
                ]);
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        async function loadStats() {
            const response = await fetch(`${API_BASE}/honeypot/stats`);
            const data = await response.json();

            document.getElementById('totalAttacks').textContent = data.total_attacks || 0;
            document.getElementById('uniqueIPs').textContent = data.top_attackers?.length || 0;
            document.getElementById('activeSessions').textContent = data.top_attackers?.reduce((sum, a) => sum + a.count, 0) || 0;

            // Render attack type chart
            renderAttackTypeChart(data.attacks_by_type || {});

            // Render top attackers
            renderTopAttackers(data.top_attackers || []);

            // Render recent attacks table
            renderRecentAttacks(data.recent_attacks || []);
        }

        function renderAttackTypeChart(attacksByType) {
            const container = document.getElementById('attackTypeChart');
            const maxCount = Math.max(...Object.values(attacksByType), 1);

            container.innerHTML = Object.entries(attacksByType)
                .sort((a, b) => b[1] - a[1])
                .map(([type, count]) => {
                    const percentage = (count / maxCount) * 100;
                    return `
                        <div class="bar-item">
                            <div class="bar-label">${type}</div>
                            <div class="bar-fill" style="width: ${percentage}%">
                                <span class="bar-value">${count}</span>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        function renderTopAttackers(topAttackers) {
            const container = document.getElementById('topAttackers');
            
            if (topAttackers.length === 0) {
                container.innerHTML = '<div class="no-data">No attackers detected yet</div>';
                return;
            }

            container.innerHTML = topAttackers.slice(0, 5).map((attacker, index) => `
                <div class="attacker-item">
                    <div class="attacker-rank">${index + 1}</div>
                    <div class="attacker-info">
                        <div class="ip-address">${attacker.ip}</div>
                    </div>
                    <div class="attacker-count">${attacker.count} attacks</div>
                </div>
            `).join('');
        }

        function renderRecentAttacks(attacks) {
            const container = document.getElementById('recentAttacks');
            
            if (attacks.length === 0) {
                container.innerHTML = '<div class="no-data">No attacks detected yet. The honeypot is running and waiting...</div>';
                return;
            }

            container.innerHTML = `
                <table class="attack-table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>IP Address</th>
                            <th>Attack Type</th>
                            <th>Endpoint</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${attacks.map(attack => `
                            <tr>
                                <td class="timestamp">${formatTimestamp(attack.timestamp)}</td>
                                <td class="ip-address">${attack.ip}</td>
                                <td>${renderAttackBadges(attack.type)}</td>
                                <td>${attack.endpoint}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderAttackBadges(types) {
            if (!types || types === 'recon') {
                return '<span class="badge badge-recon">recon</span>';
            }

            return types.split(',').map(type => {
                const badgeClass = `badge-${type.split('_')[0]}`;
                return `<span class="badge ${badgeClass}">${type}</span>`;
            }).join(' ');
        }

        async function loadIOCs() {
            const response = await fetch(`${API_BASE}/honeypot/iocs`);
            const data = await response.json();

            document.getElementById('totalIOCs').textContent = data.iocs?.length || 0;
            renderIOCs(data.iocs || []);
        }

        function renderIOCs(iocs) {
            const container = document.getElementById('iocList');
            
            if (iocs.length === 0) {
                container.innerHTML = '<div class="no-data">No IOCs generated yet. IOCs are created every 5 minutes based on attack patterns.</div>';
                return;
            }

            container.innerHTML = iocs.slice(0, 10).map(ioc => `
                <div class="ioc-item">
                    <div class="ioc-header">
                        <div>
                            <strong>${ioc.type.toUpperCase()}</strong>
                            <div class="timestamp">${formatTimestamp(ioc.timestamp)}</div>
                        </div>
                        <span class="confidence">${(ioc.confidence * 100).toFixed(0)}% confidence</span>
                    </div>
                    <div class="ioc-value">${ioc.value}</div>
                    ${ioc.pattern ? `<div class="timestamp" style="margin-top: 8px;">Pattern: ${ioc.pattern}</div>` : ''}
                </div>
            `).join('');
        }

        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString();
        }

        async function exportData() {
            try {
                const response = await fetch(`${API_BASE}/honeypot/export`);
                const data = await response.json();
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `shadowvault-export-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                alert('‚úÖ Data exported successfully!');
            } catch (error) {
                alert('‚ùå Export failed: ' + error.message);
            }
        }

        // Auto-refresh every 5 seconds
        setInterval(loadData, 5000);

        // Initial load
        loadData();
    </script>
</body>
</html>